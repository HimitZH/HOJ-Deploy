version: "3"
services:

  hoj-judgeserver:
    image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_judgeserver
    container_name: hoj-judgeserver
    restart: always
    volumes:
      - ./judge/test_case:/judge/test_case
      - ./judge/log:/judge/log
      - ./judge/run:/judge/run
      - ./judge/spj:/judge/spj
      - ./judge/log/judgeserver:/judge/log/judgeserver
    environment:
      - TZ=Asia:/Shanghai
      - JUDGE_SERVER_IP=Your_Public_IP # 服务器公网ip
      - JUDGE_SERVER_PORT=8088
      - JUDGE_SERVER_NAME=hoj-judger-1 # 判题服务的名称，最好每个判题机不一样
      - NACOS_URL=Nacos_Public_IP:8848  # nacos所在服务的ip:port
      - NACOS_USERNAME=nacos           # 分布式需要修正nacos账号密码
      - NACOS_PASSWORD=nacos
      - MAX_TASK_NUM=-1 # -1表示最大并行任务数为cpu核心数*2
      - REMOTE_JUDGE_OPEN=true # 当前判题服务器是否开启远程虚拟判题功能
      - REMOTE_JUDGE_MAX_TASK_NUM=-1 # -1表示最大并行任务数为(cpu核心数*2)*2
    ports:
      - "0.0.0.0:8088:8088"
      # - "0.0.0.0:5050:5050" # 一般不开放安全沙盒端口
    privileged: true # 设置容器的权限为root

  hoj-rsync-slave:
    image: registry.cn-shenzhen.aliyuncs.com/hcode/hoj_rsync:1.0
    container_name: hoj-rsync-slave
    restart: always
    volumes:
      - ./judge/test_case:/hoj/testcase
      - ./judge/log:/hoj/log
    environment:
      - RSYNC_MODE=slave
      - RSYNC_USER=hojrsync
      - RSYNC_PASSWORD=hoj123456 # 请修改这里 与主服务器的rsync密码一致
      - RSYNC_MASTER_ADDR=127.0.0.1 # 请修改这里 写入主服务器ip
    ports:
      - "0.0.0.0:873:873"